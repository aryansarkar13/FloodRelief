
<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

   <link rel="stylesheet" type="text/css" href="style.css">
    <title>Map</title>
  </head>
  <body onload="initialize()">
      <br>
      <h1>Efficient Flood Rescue</h1>
      <br>
    <div id="map">
        </div>
      <br>
      <div id="searchbox">
      Name of Location:
      <input type="text" id="searchplace" name="searchplace" value="" onkeydown="search(event);">
          <input type="button" id="searchbutton" onclick="searchMap()" value="Locate">
          </div>
      <br>
      <div id="NW">
      North West Corner :<br>
          Latitude : <input type="text" name="minLatitude" id="minLatitude" value="" style="width:120px;">
          Longitude :<input type="text" name="minLongitude" id="minLongitude" value="" style="width:120px;">
      </div>
      <br>
      <div id="SE">
      South East Corner :<br>
          Latitude : <input type="text" name="maxLatitude" id="maxLatitude" value="" style="width:120px;">
          Longitude : <input type="text" name="maxLongitude" id="maxLongitude" value="" style="width:120px;">
      </div>
      <br>
      <div id="btn">
      <input id="btn1" type="button" onclick="setCoords()" value="Get Latitude & Longitude" title="retrieve elevation data">
          </div>
<script>
    var geocoder;
    var markers = [];
    var rectangle = new Array();
function initialize() {
 geocoder = new google.maps.Geocoder();
  var myLatLng = new google.maps.LatLng(0, 0);
  var mapOptions = {
    zoom: 2,
    center: myLatLng,
    mapTypeId: google.maps.MapTypeId.HYBRID
  };

  map = new google.maps.Map(document.getElementById("map"), mapOptions);
    
     google.maps.event.addListener(map, 'click', function(event) {
    addMarker(event.latLng);
  });

}
    function searchMap(){
var searchterm = $('#searchplace').val();
if (searchterm != ""){
  geocoder.geocode( { 'address': searchterm}, function(results, status) {
  console.log(results);
    if (status == google.maps.GeocoderStatus.OK) {
      map.setCenter(results[0].geometry.location);
	  map.fitBounds(results[0].geometry.viewport);
    } else {
      alert('Geocode was not successful for the following reason: ' + status);
    }
  });
}}

function search(event) {
		if (event.keyCode == 13) {
			searchMap();
		}
}
    
    function addMarker(location){
        if(markers.length<2){
            var marker = new google.maps.Marker({
                position: location,
                draggable: true,
                map: map
            });
            markers.push(marker);
            google.maps.event.addListener(markers[markers.length-1], "position_changed", function() {changeRectangle()});
        }
        if (markers.length == 2){
          drawRectangle();
      }
        
    }
    
    function changeRectangle(){
    if (markers.length == 2){
if (rectangle.length!=0){
NWc = markers[0].getPosition();
SEc = markers[1].getPosition();
/*
b = new google.maps.LatLngBounds(
	new google.maps.LatLng(Math.max(NWc.ob,SEc.ob), Math.min(NWc.pb,SEc.pb)),
    new google.maps.LatLng(Math.min(NWc.ob,SEc.ob), Math.max(NWc.pb,SEc.pb)));*/

b = new google.maps.LatLngBounds(
	new google.maps.LatLng(Math.max(NWc.lat('get'),SEc.lat('get')), Math.min(NWc.lng('get'),SEc.lng('get'))),
    new google.maps.LatLng(Math.min(NWc.lat('get'),SEc.lat('get')), Math.max(NWc.lng('get'),SEc.lng('get'))));	
	
	
rectangle.setBounds(b);
}
else
{
    drawRectangle();
}
}} 
    
function setCoords() {
if (markers.length == 2){
//console.log(markers.length);
NWc = markers[0].getPosition();
SEc = markers[1].getPosition();
document.getElementById("minLatitude").value = NWc.lat('get');
document.getElementById("minLongitude").value = NWc.lng('get');
document.getElementById("maxLatitude").value = SEc.lat('get');
document.getElementById("maxLongitude").value = SEc.lng('get');
//getData();
}
else if (
document.getElementById("minLatitude").value != "" && 
document.getElementById("minLongitude").value != "" && 
document.getElementById("maxLatitude").value != "" &&
document.getElementById("maxLongitude").value != ""){
//getData();
}
else{
alert("Define an area first by clicking on the map, defining two diagonal corners of a rectangle.");
}}    
    
function drawRectangle(){
var b = "";
var c = new Array();
c[0] = document.getElementById("minLatitude").value;
c[1] = document.getElementById("minLongitude").value;
c[2] = document.getElementById("maxLatitude").value;
c[3] = document.getElementById("maxLongitude").value;
if (markers.length == 2){
	NWc = markers[0].getPosition();
	SEc = markers[1].getPosition();
	
	b = new google.maps.LatLngBounds(
	new google.maps.LatLng(Math.max(NWc.lat('get'),SEc.lat('get')), Math.min(NWc.lng('get'),SEc.lng('get'))),
    new google.maps.LatLng(Math.min(NWc.lat('get'),SEc.lat('get')), Math.max(NWc.lng('get'),SEc.lng('get'))));
	
}
else if (c[0] != "" && c[1] != "" && c[2] != "" && c[3] != ""){
b = new google.maps.LatLngBounds(
	new google.maps.LatLng(Math.max(c[0],c[2]), Math.min(c[1],c[3])),
    new google.maps.LatLng(Math.min(c[0],c[2]), Math.max(c[1],c[3])));
}

	if (b!="") {
	alert(b);
//	clearMap('rectangle');
    rectangle = new google.maps.Rectangle({
    strokeColor: '#000000',
    strokeOpacity: 0.8,
    strokeWeight: 1,
    fillColor: '#000000',
    fillOpacity: 0.15,
    map: map,
    bounds: b    
  });
// fitMap();
  //document.getElementById("clearRectangleButton").style.display = "";
 } 
}
    
function clearMap(what){

if (what == "rectangle" || what == "all"){
if (rectangle.length!=0){
rectangle.setMap(null);
rectangle = new Array();
}}

if (what == "marker" || what == "all"){
for (iM in markers){
markers[iM].setMap(null);
}
markers = [];
}

if (what == "contour" || what == "all"){
for (iL in polyLineArray){
polyLineArray[iL].setMap(null);
}
polyLineArray = [];
}

if (what == "samplepoints" || what == 'all'){
for (iSP in samplePoints){
samplePoints[iSP].setMap(null);
}
samplePoints = [];
sampleCoordinates = [];
}

document.getElementById("clearMapMenu").options[0].selected = true;

}
    
function fitMap(){
var c = new Array();
c[0] = document.getElementById("minLatitude").value;
c[1] = document.getElementById("minLongitude").value;
c[2] = document.getElementById("maxLatitude").value;
c[3] = document.getElementById("maxLongitude").value;

if (c[0] != "" && c[1] != "" && c[2] != "" && c[3] != ""){
b = new google.maps.LatLngBounds(
	new google.maps.LatLng(Math.max(c[0],c[2]), Math.min(c[1],c[3])),
    new google.maps.LatLng(Math.min(c[0],c[2]), Math.max(c[1],c[3])));
	map.fitBounds(b);
}
}
        
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBc_xe_BeAqImyhNzXiRlH62-ajhuN1zxk&callback=initialize">
        </script>
    
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </body>
</html>
